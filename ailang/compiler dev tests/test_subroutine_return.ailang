// test_subroutine_return.ailang
// Test ReturnValue in SubRoutine context

PrintMessage("=== SUBROUTINE RETURN TEST ===")
PrintMessage("")

// Test 1: SubRoutine without ReturnValue
SubRoutine NoReturn {
    PrintMessage("NoReturn: This should print")
    x = 42
    PrintMessage("NoReturn: This should also print")
}

PrintMessage("Test 1: No ReturnValue")
RunTask(NoReturn)
PrintMessage("Test 1: Complete")
PrintMessage("")

// Test 2: SubRoutine with ReturnValue at end
SubRoutine ReturnAtEnd {
    PrintMessage("ReturnAtEnd: Start")
    PrintMessage("ReturnAtEnd: Middle")
    PrintMessage("ReturnAtEnd: Before return")
    ReturnValue(99)
}

PrintMessage("Test 2: ReturnValue at end")
RunTask(ReturnAtEnd)
PrintMessage("Test 2: Complete")
PrintMessage("")

// Test 3: SubRoutine with early ReturnValue
SubRoutine EarlyReturn {
    PrintMessage("EarlyReturn: Start")
    
    x = 1
    IfCondition EqualTo(x, 1) ThenBlock: {
        PrintMessage("EarlyReturn: Condition met, returning early")
        ReturnValue(42)
    }
    
    PrintMessage("EarlyReturn: THIS SHOULD NOT PRINT!")
    PrintMessage("EarlyReturn: If you see this, ReturnValue didn't work")
}

PrintMessage("Test 3: Early ReturnValue")
RunTask(EarlyReturn)
PrintMessage("Test 3: Complete")
PrintMessage("")

// Test 4: Nested conditions with ReturnValue
SubRoutine NestedReturn {
    PrintMessage("NestedReturn: Start")
    
    a = 5
    IfCondition GreaterThan(a, 3) ThenBlock: {
        PrintMessage("NestedReturn: a > 3")
        
        b = 10
        IfCondition GreaterThan(b, 8) ThenBlock: {
            PrintMessage("NestedReturn: b > 8, returning")
            ReturnValue(777)
        }
        
        PrintMessage("NestedReturn: THIS SHOULD NOT PRINT!")
    }
    
    PrintMessage("NestedReturn: THIS SHOULD ALSO NOT PRINT!")
}

PrintMessage("Test 4: Nested ReturnValue")
RunTask(NestedReturn)
PrintMessage("Test 4: Complete")
PrintMessage("")

// Test 5: What happens with the return value?
// Note: SubRoutines put value in RAX but RunTask doesn't capture it
SubRoutine ReturnValue123 {
    PrintMessage("ReturnValue123: Returning 123")
    ReturnValue(123)
}

PrintMessage("Test 5: Return value handling")
RunTask(ReturnValue123)
// Can't capture the value since RunTask doesn't return it
// But it shouldn't crash
PrintMessage("Test 5: Complete (value was in RAX but not captured)")
PrintMessage("")

PrintMessage("=== ALL RETURN TESTS COMPLETE ===")
PrintMessage("Check which messages printed to see if ReturnValue works correctly")