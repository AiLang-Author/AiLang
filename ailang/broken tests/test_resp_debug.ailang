// test_resp_debug.ailang
// Debug the RESP.Array segfault

LibraryImport.Library.RESP

PrintMessage("=== RESP Array Debug ===")
PrintMessage("")

// Test 1: Create array manually
PrintMessage("Test 1: Creating array...")
arr = ArrayCreate(3)
PrintMessage("  Array created")

// Test 2: Set values
PrintMessage("Test 2: Setting values...")
ArraySet(arr, 0, "first")
PrintMessage("  Set index 0")
ArraySet(arr, 1, "second")
PrintMessage("  Set index 1")
ArraySet(arr, 2, "third")
PrintMessage("  Set index 2")

// Test 3: Verify array
PrintMessage("Test 3: Verifying array...")
val = ArrayGet(arr, 0)
PrintMessage("  arr[0] = ")
PrintMessage(val)
val = ArrayGet(arr, 1)
PrintMessage("  arr[1] = ")
PrintMessage(val)
val = ArrayGet(arr, 2)
PrintMessage("  arr[2] = ")
PrintMessage(val)

// Test 4: Check array length
PrintMessage("Test 4: Array length...")
len = ArrayLength(arr)
PrintMessage("  Length = ")
PrintNumber(len)

// Test 5: Call RESP.Array with debugging
PrintMessage("Test 5: Calling RESP.Array...")
PrintMessage("  About to call RESP.Array")

// The crash happens here
response = RESP.Array(arr)

PrintMessage("  RESP.Array returned")
PrintMessage("  Response: ")
PrintMessage(response)

// Cleanup
ArrayDestroy(arr)
Deallocate(response, 0)

PrintMessage("")
PrintMessage("=== Test Complete ===")